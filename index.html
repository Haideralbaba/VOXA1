<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VOXA — مساعدك الإبداعي</title>

<!-- خط وأيقونات -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;800&display=swap" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />

<style>
:root{
  --background-needle: #d4af37; /* لون ذهبي للخلفية المتحركة */
  --bg-color1: #000; /* أسود */
  --bg-color2: #000;
  --txt:#f7f9ff;
  --muted:#b8c2d9;
  --primary:#d4af37;   /* ذهبي */
  --secondary:#b8860b; /* لون ذهبي غامق */
  --accent:#ffd700;    /* ذهبي ساطع */
  --card: rgba(255,255,255,.06);
  --border: rgba(255,255,255,.16);
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius:18px;
  --ring: 0 0 0 4px rgba(139,92,246,.24);
  --success:#22c55e;
}

*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Arabic",sans-serif;
  color:var(--txt);
  background:#000; /* خلفية أسود كخلفية أساسية */
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  transition: background 1s ease;
}

/* الخلفية المتحركة والملفتة مع مؤشر الماوس */
body::before{
  content:"";
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:radial-gradient(circle at 50% 50%, rgba(212,175,55,0.05), transparent 70%), 
             radial-gradient(circle at 20% 80%, rgba(212,175,55,0.05), transparent 70%), 
             radial-gradient(circle at 80% 20%, rgba(212,175,55,0.05), transparent 70%);
  background-repeat:no-repeat;
  background-size:200% 200%;
  pointer-events:none;
  z-index:0;
  transition: background-position 0.3s;
}

/* تأثير لتفاعل الخلفية مع الماوس */
body.mouse-move::before{
  background-position: var(--bg-x,50%) var(--bg-y,50%);
}

/* تفاعل مع مؤشر الماوس عبر JavaScript */
body{
  cursor: crosshair;
}

/* الزر الدائري الدردشة */
#chat-toggle-btn{
  position:fixed;
  bottom:20px;
  left:20px;
  width:60px;
  height:60px;
  background:linear-gradient(135deg, var(--secondary), var(--accent));
  border: none;
  border-radius:50%;
  box-shadow: 0 4px 15px rgba(0,0,0,.2);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  color:#fff;
  z-index:100;
  transition: background 0.3s, box-shadow 0.3s;
}
#chat-toggle-btn:hover{
  background:linear-gradient(135deg, var(--accent), var(--secondary));
  box-shadow: 0 6px 20px rgba(0,0,0,.3);
}

/* حاوية الدردشة */
.chat{
  position: fixed; 
  bottom:80px; /* أعلى قليلاً من زر */
  left:20px;
  width:320px;
  height:400px;
  display:flex; 
  flex-direction:column; 
  border-radius:18px;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  border:1px solid var(--border); 
  backdrop-filter: blur(14px) saturate(140%);
  box-shadow: var(--shadow); 
  overflow:hidden; 
  z-index:200;
  opacity:0;
  transform: translateY(20px);
  transition: opacity 0.3s, transform 0.3s;
}
.chat.show{opacity:1; transform: translateY(0);}

/* الرأسية */
.chat-header{
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  padding:14px; 
  background: linear-gradient(90deg, rgba(139,92,246,.22), transparent 40%), 
              linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0));
  border-bottom: 1px solid var(--border);
}
.chat-header .title{
  font-weight:800; 
  font-size:14px; 
  color:#2563eb; /* لون أزرق جذاب */
}
.chat-close{
  background:none; border:none; cursor:pointer; font-size:18px; color:#fff; transition: color .2s;
}
.chat-close:hover{ color:#ff4c4c; }

/* الجسم */
.chat-body{
  flex:1; 
  overflow:auto; 
  padding:14px; 
  display:flex; 
  flex-direction:column; 
  gap:10px; 
  scrollbar-width: thin; 
  scrollbar-color: rgba(255,255,255,.25) transparent;
}
.chat-body::-webkit-scrollbar{ width:8px }
.chat-body::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.25); border-radius:999px }

/* الرسائل */
.msg{
  max-width: 85%; 
  padding:10px 12px; 
  border-radius:14px; 
  font-size:14px; 
  line-height:1.6;
  transition: opacity 0.3s ease;
}
.msg.user{
  align-self:flex-end; 
  background:#d4af37; /* لون ذهبي فاتح */
  color:#fff; 
  border-top-right-radius:6px; 
}
.msg.bot{
  align-self:flex-start; 
  background:#f0f0f0; /* رمادي فاتح */
  color:#000;
  border-top-left-radius:6px;
}
/* تأثير fade-in للرسائل */
.msg.show{opacity:1; transform:translateY(0);}
.msg{opacity:0; transform:translateY(6px);}

/* الإدخال */
.chat-footer{
  display:flex; 
  padding:12px; 
  border-top:1px solid var(--border); 
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
}
#chat-input{
  flex:1; 
  padding:12px 14px; 
  border-radius:12px; 
  border:1px solid var(--border); 
  background: rgba(255,255,255,.06); 
  color:var(--txt); 
  outline:none; 
  transition: border-color .2s, box-shadow .2s;
}
#chat-input:focus{
  border-color: rgba(255,255,255,.36);
  box-shadow: 0 0 0 4px rgba(139,92,246,.18);
}
.send-btn{
  width:46px; 
  height:46px; 
  border:none; 
  border-radius:12px; 
  margin-left:8px;
  cursor:pointer; 
  display:flex; 
  align-items:center; 
  justify-content:center;
  background: linear-gradient(135deg, var(--accent), var(--secondary));
  color:#fff;
  font-size:18px;
  transition: background 0.3s, transform 0.2s;
}
.send-btn:hover{
  background:linear-gradient(135deg, var(--secondary), var(--accent));
  transform:translateY(-2px);
}
/* تأثير الضغط */
.send-btn:active{
  transform:translateY(0);
}

/* تأثير الحركة */
@media (prefers-reduced-motion: reduce){
  *{animation:none!important; transition:none!important}
}
</style>
</head>
<body>

<!-- زر متفاعل مع الماوس -->
<button id="chat-toggle-btn" aria-haspopup="dialog" aria-controls="chat" aria-expanded="false">
  <i class="fa-solid fa-comments"></i>
</button>

<!-- نافذة الدردشة -->
<section class="chat" id="chat" role="dialog" aria-modal="true" aria-label="نافذة الدردشة" aria-hidden="true">
  <div class="chat-header">
    <div class="title">مساعدك الذكي</div>
    <button class="chat-close" id="close-chat" aria-label="إغلاق النافذة"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="chat-body" id="chat-body"></div>
  <div class="chat-footer">
    <input type="text" id="chat-input" placeholder="اكتب رسالتك..." aria-label="اكتب رسالة" />
    <button class="send-btn" id="send-btn" aria-label="إرسال"><i class="fa-solid fa-paper-plane"></i></button>
  </div>
</section>

<script>
  // متغيرات الربط مع Rasa
  const RASA_URL = "http://localhost:5005/webhooks/rest/webhook"; // هنا ضع رابط Rasa الخاص بك
  const SENDER_ID = "voxa-" + Math.random().toString(36).slice(2, 9);

  const chatBtn = document.getElementById('chat-toggle-btn');
  const chatSection = document.getElementById('chat');
  const closeBtn = document.getElementById('close-chat');
  const chatBody = document.getElementById('chat-body');
  const input = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');

  // فتح وإغلاق النافذة
  chatBtn.addEventListener('click', ()=> {
    chatSection.classList.add('show');
    chatSection.setAttribute('aria-hidden','false');
  });
  document.getElementById('close-chat').addEventListener('click', ()=> {
    chatSection.classList.remove('show');
    chatSection.setAttribute('aria-hidden','true');
  });

  // تفاعل خلفية الماوس
  document.body.addEventListener('mousemove', e => {
    const x = e.clientX / window.innerWidth * 100;
    const y = e.clientY / window.innerHeight * 100;
    document.body.style.setProperty('--bg-x', x + '%');
    document.body.style.setProperty('--bg-y', y + '%');
  });
  document.body.classList.add('mouse-move');

  // الدوال لإضافة رسائل
  function addMessage(text, sender='user'){
    const div = document.createElement('div');
    div.className = 'msg ' + sender;
    div.innerHTML = text;
    div.classList.add('show');
    chatBody.appendChild(div);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  // إرسال للـ Rasa
  async function sendToRasa(message){
    try{
      const res = await fetch(RASA_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({sender:SENDER_ID,message})
      });
      const data = await res.json();
      const texts = data.map(m=>m.text).filter(Boolean).join('<br>');
      return texts || 'شكرًا على تواصلك. كيف يمكنني المساعدة أكثر؟';
    }catch(e){
      return 'عذرًا، لم أتمكن من الاتصال الآن. حاول مرة أخرى لاحقًا.';
    }
  }

  // عند ضغط زر الإرسال
  document.getElementById('send-btn').addEventListener('click', async ()=>{
    const msg = input.value.trim();
    if(!msg) return;
    addMessage(msg, 'user');
    input.value = '';
    const reply = await sendToRasa(msg);
    addMessage(reply,'bot');
  });
  document.getElementById('chat-input').addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      e.preventDefault();
      document.getElementById('send-btn').click();
    }
  });
</script>

</body>
</html>
